<p id="notice"><%= notice %></p>
<div class="row" style="padding-top: 70px;">
	<div style='width: 100%; overflow: auto;'>
	  <ul class="nav">
		<% @tracker["info"].each do |info|%>	  	
	    	<li class="nav-item" style="float:left;"> 
	           <i class="material-icons" style="float: left;">commute</i> 
	           <p class="nav-link" style="float: left;">Device <%= info["device_id"] %></p>
	    	</li>
	    	<li class="nav-item" style="float:left;"> 
	           <i class="material-icons" style="float: left;">commute</i> 
	           <p class="nav-link" style="float: left;">Speed: <%= info["speed"] %></p>
	    	</li>
	    	<li class="nav-item" style="float:left;"> 
	           <i class="material-icons" style="float: left;">commute</i> 
	           <p class="nav-link" style="float: left;">Height Above Sea: <%= info["height_above_sea"] %></p>
	    	</li>		    		    	
	    	<li class="nav-item" style="float:left;"> 
	           <i class="material-icons" style="float: left;">commute</i> 
	           <p class="nav-link" style="float: left;">Last Seen: <%= info["updated_at"] %></p>
	    	</li>				    	
	    <% end %>
	  </ul>
	</div>
	<!-- Display Google Map Here -->
	<div style='width: 100%;'>
	  <div id="map" style="height: 600px;"></div>
	</div>
</div>

<script type="text/javascript">
  handler = Gmaps.build('Google');
  handler.buildMap({ provider: {disableDefaultUI: true, autoZoom: true}, internal: {id: 'map'}}, function(){
    markers = handler.addMarkers(<%=raw @hash.to_json %>);
    // handler.bounds.extendWith(markers);
    handler.map.centerOn(markers[0]);
    $( document ).ready(function() { 
      setInterval(function(){
          $(function () {
              $.ajax({
                url:"/single_device/",
                dataType:'json',
                data: {id: <%=raw params[:id] %>},
                success: function(data){
                  var results = data;
                  results[0].lat = "11.833333";
                  results[0].lng = "13.150000"; 
                  console.log(results[0].lat);                                  
                  markers[0].setMap(null);
                  handler.removeMarkers(markers);
                  markers = [];
                  markers = handler.addMarkers(results);  
                  handler.map.centerOn(markers[0]); 

     //              url:"/trackers/" + <%=raw params[:id] %> ,
     //              dataType: 'json',
				 //  success: function(data){
					// var results = data;
					// console.log(results.lat);                                  
					// markers[0].setMap(null);
					// handler.removeMarkers(markers);
					// markers = [];
					// markers = handler.addMarkers(results);  
					// handler.map.centerOn(markers[0]);                  
                }
              })
          });
        }, 30000);  
        handler.getMap().setZoom(18);  
    });
  });  
</script>

 
